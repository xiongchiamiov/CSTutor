<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>code coverage of views.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<style type="text/css">
pre.code {
    font-style: Lucida,"Courier New";
}
.number {
    color: #0080C0;
}
.operator {
    color: #000000;
}
.string {
    color: #008000;
}
.comment {
    color: #808080;
}
.name {
    color: #000000;
}
.error {
    color: #FF8080;
    border: solid 1.5pt #FF0000;
}
.keyword {
    color: #0000FF;
    font-weight: bold;
}
.text {
    color: #000000;
}
.notcovered {
    background-color: #FFB2B2;
}
</style>

</head>
<body>
<pre class="code">
<span class="string">'''
Views file for quiz related views

This file contains methods for creating a quiz and showing a quiz. More methods will be added to this file in time.

@author Evan Kleist
'''</span><span class="text">
</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">core</span><span class="operator">.</span><span class="name">urlresolvers</span> <span class="keyword">import</span> <span class="name">reverse</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">shortcuts</span> <span class="keyword">import</span> <span class="name">render_to_response</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">http</span> <span class="keyword">import</span> <span class="name">HttpResponseRedirect</span><span class="operator">,</span> <span class="name">Http404</span><span class="text">
</span><span class="keyword">from</span> <span class="name">courses</span><span class="operator">.</span><span class="name">models</span> <span class="keyword">import</span> <span class="name">Course</span><span class="operator">,</span> <span class="name">Enrollment</span><span class="text">
</span><span class="keyword">from</span> <span class="name">models</span> <span class="keyword">import</span> <span class="name">Page</span><span class="text">
</span><span class="keyword">from</span> <span class="name">models</span> <span class="keyword">import</span> <span class="name">Quiz</span><span class="text">
</span><span class="keyword">from</span> <span class="name">quiz</span> <span class="keyword">import</span> <span class="operator">*</span><span class="text">
</span><span class="keyword">from</span> <span class="name">question</span><span class="operator">.</span><span class="name">models</span> <span class="keyword">import</span> <span class="name">MultipleChoiceQuestion</span><span class="text">
</span><span class="keyword">from</span> <span class="name">question</span><span class="operator">.</span><span class="name">models</span> <span class="keyword">import</span> <span class="name">CodeQuestion</span><span class="text">
</span><span class="keyword">from</span> <span class="name">question</span><span class="operator">.</span><span class="name">question</span> <span class="keyword">import</span> <span class="operator">*</span><span class="text">
</span><span class="keyword">from</span> <span class="name">home</span><span class="operator">.</span><span class="name">views</span> <span class="keyword">import</span> <span class="name">master_rtr</span><span class="operator">,</span> <span class="name">custom_403</span><span class="text">
</span><span class="keyword">from</span> <span class="name">pages</span><span class="operator">.</span><span class="name">page</span> <span class="keyword">import</span> <span class="name">insertLastChildPage</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">core</span><span class="operator">.</span><span class="name">exceptions</span> <span class="keyword">import</span> <span class="name">ObjectDoesNotExist</span><span class="text">
</span><span class="text">
</span><span class="keyword">def</span> <span class="name">create_quiz</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>        <span class="string">''' create_Quiz View
                @author John Hartquist
                This view will create a quiz and take the user to the quiz editor screen.
        '''</span><span class="text">
</span>        <span class="comment">#enforcing permissions
</span><span class="notcovered">        <span class="keyword">try</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="name">e</span> <span class="operator">=</span> <span class="name">Enrollment</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">course__slug</span> <span class="operator">=</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">user</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">except</span> <span class="name">Enrollment</span><span class="operator">.</span><span class="name">DoesNotExist</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="name">custom_403</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">"User cannot create a quiz in the course because the user is not enrolled in this course"</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="name">e</span><span class="operator">.</span><span class="name">edit</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="name">custom_403</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">"User cannot create a quiz in the course because the user does not have edit permissions on the course"</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="name">page_slug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">page_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span>        <span class="text">
</span><span class="notcovered">        <span class="keyword">if</span> <span class="name">request</span><span class="operator">.</span><span class="name">method</span> <span class="operator">==</span> <span class="string">"POST"</span> <span class="keyword">and</span> <span class="string">"Create Quiz"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="name">course</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">course_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="name">name</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'name'</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered"></span>                <span class="text">
</span><span class="notcovered">                <span class="keyword">if</span> <span class="name">name</span> <span class="operator">==</span> <span class="string">""</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/quiz/create-quiz.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'message'</span><span class="operator">:</span> <span class="string">"You may not enter a blank quiz name"</span><span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span>                <span class="text">
</span><span class="notcovered">                <span class="keyword">try</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">newQuiz</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">(</span><span class="name">course</span><span class="operator">=</span><span class="name">course</span><span class="operator">,</span> <span class="name">name</span><span class="operator">=</span><span class="name">name</span><span class="operator">,</span> <span class="name">slug</span><span class="operator">=</span><span class="name">slugify</span><span class="operator">(</span><span class="name">name</span><span class="operator">)</span><span class="operator">,</span> <span class="name">text</span><span class="operator">=</span><span class="name">name</span><span class="operator">,</span> <span class="name">upToDate</span><span class="operator">=</span><span class="name">True</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">insertLastChildPage</span><span class="operator">(</span><span class="name">newQuiz</span><span class="operator">,</span> <span class="name">Page</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">page_slug</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">newQuiz</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">newQuiz</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span></span>           <span class="text">
</span>                        <span class="name">workingCopy</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">(</span><span class="name">course</span><span class="operator">=</span><span class="name">newQuiz</span><span class="operator">.</span><span class="name">course</span><span class="operator">,</span> <span class="name">name</span><span class="operator">=</span><span class="name">newQuiz</span><span class="operator">.</span><span class="name">name</span><span class="operator">,</span> <span class="name">slug</span><span class="operator">=</span><span class="operator">(</span><span class="name">newQuiz</span><span class="operator">.</span><span class="name">slug</span> <span class="operator">+</span> <span class="string">"_workingCopy"</span><span class="operator">)</span><span class="operator">,</span> <span class="name">text</span><span class="operator">=</span><span class="name">newQuiz</span><span class="operator">.</span><span class="name">name</span><span class="operator">,</span> <span class="name">left</span><span class="operator">=</span><span class="number">0</span><span class="operator">,</span> <span class="name">right</span><span class="operator">=</span><span class="number">0</span><span class="operator">)</span><span class="text">
</span><span class="notcovered">                        <span class="name">workingCopy</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">reverse</span><span class="operator">(</span><span class="string">'pages.views.edit_page'</span><span class="operator">,</span> <span class="name">args</span><span class="operator">=</span><span class="operator">[</span><span class="name">course_slug</span><span class="operator">,</span> <span class="name">newQuiz</span><span class="operator">.</span><span class="name">slug</span><span class="operator">]</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">except</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/quiz/create-quiz.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'message'</span><span class="operator">:</span> <span class="string">"Quiz with this name already exists"</span><span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">else</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/quiz/create-quiz.html'</span><span class="operator">)</span></span><span class="text">
</span><span class="text">
</span><span class="keyword">def</span> <span class="name">show_quiz</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>        <span class="string">''' show_Quiz View
                This view displays a quiz on the screen. The user can then answer the
                questions and submit the result

                If the user is trying to view the working_copy, they are shown the
                regular copy instead. This is to prevent a student from looking
                at unpublished quizzes
        '''</span><span class="text">
</span>        <span class="name">page_slug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">page_slug</span><span class="operator">)</span><span class="text">
</span>        <span class="name">quiz</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">page_slug</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># If the quiz is hidden, make sure prerequisites have been met
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">quiz</span><span class="operator">.</span><span class="name">hidden</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="name">checkPrerequisites</span><span class="operator">(</span><span class="name">quiz</span><span class="operator">,</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/denied.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'course'</span><span class="operator">:</span><span class="name">course</span><span class="operator">,</span> <span class="string">'course_slug'</span><span class="operator">:</span><span class="name">course</span><span class="operator">,</span> <span class="string">'prereqs'</span><span class="operator">:</span><span class="name">True</span><span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span>        <span class="text">
</span>        <span class="name">quizTitle</span> <span class="operator">=</span> <span class="name">quiz</span><span class="operator">.</span><span class="name">text</span><span class="text">
</span>        <span class="name">questions</span> <span class="operator">=</span> <span class="name">quiz</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="operator">.</span><span class="name">order_by</span><span class="operator">(</span><span class="string">"order"</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/quiz/viewQuiz.html'</span><span class="operator">,</span> \
                                    <span class="operator">{</span><span class="string">'course'</span><span class="operator">:</span><span class="name">course</span><span class="operator">,</span> <span class="string">'course_slug'</span><span class="operator">:</span><span class="name">course</span><span class="operator">,</span> \
                                                         <span class="string">'quizTitle'</span><span class="operator">:</span><span class="name">quizTitle</span><span class="operator">,</span> \
                                                         <span class="string">'page_slug'</span><span class="operator">:</span><span class="name">page_slug</span><span class="operator">,</span> <span class="string">'questions'</span><span class="operator">:</span><span class="name">questions</span><span class="operator">}</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span><span class="keyword">def</span> <span class="name">delete_quiz</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>        <span class="string">''' delete_quiz View
                This view confirms deletion of a quiz. The user can then choose
                 to delete the quiz or cancel
        '''</span><span class="text">
</span><span class="notcovered">        <span class="name">page_slug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">page_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">quiz</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">page_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/quiz/delete_quiz.html'</span><span class="operator">,</span> \
                                    <span class="operator">{</span><span class="string">'course'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> <span class="string">'course_slug'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> <span class="string">'page_slug'</span><span class="operator">:</span><span class="name">page_slug</span><span class="operator">,</span> <span class="string">'quiz'</span><span class="operator">:</span><span class="name">quiz</span><span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span><span class="text">
</span><span class="keyword">def</span> <span class="name">add_path</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">,</span> <span class="name">errors</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>        <span class="string">''' add_path View
                This view allows you to add a path to the quiz. The user can then choose
                 to save the path or cancel
        '''</span><span class="text">
</span><span class="notcovered">        <span class="name">page_slug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">page_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">quiz</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">page_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">course</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">course_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">allPages</span> <span class="operator">=</span> <span class="name">course</span><span class="operator">.</span><span class="name">pages</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span>        <span class="name">pages</span> <span class="operator">=</span> <span class="operator">[</span><span class="operator">]</span><span class="text">
</span><span class="notcovered">        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">allPages</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">if</span> <span class="operator">(</span><span class="name">p</span><span class="operator">.</span><span class="name">slug</span> <span class="operator">==</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">p</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">pages</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="name">p</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/quiz/path.html'</span><span class="operator">,</span> \
                                    <span class="operator">{</span><span class="string">'course_slug'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> <span class="string">'page_slug'</span><span class="operator">:</span><span class="name">page_slug</span><span class="operator">,</span> <span class="string">'pages'</span><span class="operator">:</span><span class="name">pages</span><span class="operator">,</span> <span class="string">'errors'</span><span class="operator">:</span><span class="name">errors</span><span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span><span class="text">
</span><span class="keyword">def</span> <span class="name">edit_path</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">,</span> <span class="name">errors</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>        <span class="string">''' edit_path View
                This view allows you to edit an existing path for the quiz. The user can then choose
                 to save the path or cancel
        '''</span><span class="text">
</span><span class="notcovered">        <span class="name">page_slug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">page_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">quiz</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">page_slug</span> <span class="operator">+</span> <span class="string">"_workingCopy"</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">course</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">course_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">allPages</span> <span class="operator">=</span> <span class="name">course</span><span class="operator">.</span><span class="name">pages</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">pages</span> <span class="operator">=</span> <span class="operator">[</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">allPages</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">if</span> <span class="operator">(</span><span class="name">p</span><span class="operator">.</span><span class="name">slug</span> <span class="operator">==</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">p</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">pages</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="name">p</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="name">path</span> <span class="operator">=</span> <span class="name">quiz</span><span class="operator">.</span><span class="name">paths</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">lowscore</span><span class="operator">=</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"path"</span><span class="operator">]</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/quiz/path.html'</span><span class="operator">,</span> \
                                    <span class="operator">{</span><span class="string">'course_slug'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> <span class="string">'page_slug'</span><span class="operator">:</span><span class="name">page_slug</span><span class="operator">,</span> <span class="string">'pages'</span><span class="operator">:</span><span class="name">pages</span><span class="operator">,</span> <span class="string">'path'</span><span class="operator">:</span><span class="name">path</span><span class="operator">,</span> <span class="string">'errors'</span><span class="operator">:</span><span class="name">errors</span><span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span><span class="text">
</span><span class="text">
</span><span class="text">
</span><span class="keyword">def</span> <span class="name">remove_question</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">,</span> <span class="name">qNum</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>        <span class="string">''' remove_question View
                This view confirms deletion of a question. The user can then choose
                 to delete the question or cancel
        '''</span><span class="text">
</span><span class="notcovered">        <span class="name">page_slug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">page_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">quiz</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">page_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">question</span> <span class="operator">=</span> <span class="name">quiz</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">order</span><span class="operator">=</span><span class="name">qNum</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/quiz/remove_question.html'</span><span class="operator">,</span> \
                                    <span class="operator">{</span><span class="string">'course'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> <span class="string">'course_slug'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> <span class="string">'page_slug'</span><span class="operator">:</span><span class="name">page_slug</span><span class="operator">,</span> <span class="string">'question'</span><span class="operator">:</span><span class="name">question</span><span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span><span class="text">
</span><span class="keyword">def</span> <span class="name">submitQuiz</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>        <span class="string">''' submitQuiz View
                This view will submit a quiz and create a statistic in the database. It will give the user
                their score and then direct the user to the appropriate path
        '''</span><span class="text">
</span>        <span class="name">page_slug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">page_slug</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Make sure the course actually exists in the database
</span>        <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                <span class="name">course</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">course_slug</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">except</span> <span class="name">Course</span><span class="operator">.</span><span class="name">DoesNotExist</span><span class="operator">:</span><span class="text">
</span>                <span class="keyword">raise</span> <span class="name">Http404</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Make sure the quiz actually exists in the database
</span>        <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                <span class="name">quiz</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">page_slug</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">except</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">DoesNotExist</span><span class="operator">:</span><span class="text">
</span>                <span class="keyword">raise</span> <span class="name">Http404</span><span class="text">
</span><span class="text">
</span>        <span class="comment">#if the course is private then check that the user is enrolled and has view permissions
</span>        <span class="keyword">if</span> <span class="name">course</span><span class="operator">.</span><span class="name">private</span><span class="operator">:</span><span class="text">
</span>                <span class="keyword">if</span> <span class="keyword">not</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">.</span><span class="name">is_authenticated</span><span class="operator">(</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/denied.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'course'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> <span class="string">'enrolled'</span><span class="operator">:</span><span class="name">False</span><span class="operator">,</span> <span class="string">'edit'</span><span class="operator">:</span><span class="name">False</span><span class="operator">,</span> <span class="string">'loggedIn'</span><span class="operator">:</span><span class="name">False</span><span class="operator">}</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">try</span><span class="operator">:</span><span class="comment">#try to get the enrollment for this user and check view permission</span><span class="text">
</span>                        <span class="name">e</span> <span class="operator">=</span> <span class="name">quiz</span><span class="operator">.</span><span class="name">course</span><span class="operator">.</span><span class="name">roster</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">user</span><span class="operator">=</span><span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">)</span><span class="text">
</span>                        <span class="keyword">if</span> <span class="keyword">not</span> <span class="name">e</span><span class="operator">.</span><span class="name">view</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                                <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/denied.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'course'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> <span class="string">'enrolled'</span><span class="operator">:</span><span class="name">True</span><span class="operator">,</span> <span class="string">'edit'</span><span class="operator">:</span><span class="name">False</span><span class="operator">,</span> <span class="string">'loggedIn'</span><span class="operator">:</span><span class="name">True</span><span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span>                <span class="keyword">except</span> <span class="name">ObjectDoesNotExist</span><span class="operator">:</span><span class="text">
</span>                        <span class="comment"># user is not enrolled in this course
</span>                        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/denied.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'course'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> <span class="string">'enrolled'</span><span class="operator">:</span><span class="name">False</span><span class="operator">,</span> <span class="string">'edit'</span><span class="operator">:</span><span class="name">False</span><span class="operator">,</span> <span class="string">'loggedIn'</span><span class="operator">:</span><span class="name">True</span><span class="operator">}</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Make sure prerequisites are satisfied
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="keyword">not</span> <span class="name">checkPrerequisites</span><span class="operator">(</span><span class="name">quiz</span><span class="operator">,</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/denied.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'course'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> <span class="string">'course_slug'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> <span class="string">'prereqs'</span><span class="operator">:</span><span class="name">True</span><span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span><span class="text">
</span>        <span class="name">maxScore</span> <span class="operator">=</span> <span class="name">len</span><span class="operator">(</span><span class="name">quiz</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="operator">)</span><span class="text">
</span>        <span class="name">score</span> <span class="operator">=</span> <span class="number">0</span><span class="text">
</span>        <span class="name">percentage</span> <span class="operator">=</span> <span class="number">100</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">method</span> <span class="operator">==</span> <span class="string">"POST"</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="name">score</span> <span class="operator">=</span> <span class="name">scoreQuiz</span><span class="operator">(</span><span class="name">quiz</span><span class="operator">,</span> <span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="text">
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="keyword">not</span> <span class="operator">(</span><span class="name">maxScore</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="name">percentage</span> <span class="operator">=</span> <span class="name">round</span><span class="operator">(</span><span class="name">float</span><span class="operator">(</span><span class="name">score</span><span class="operator">)</span> <span class="operator">/</span> <span class="name">float</span><span class="operator">(</span><span class="name">maxScore</span><span class="operator">)</span><span class="operator">,</span> <span class="number">2</span><span class="operator">)</span> <span class="operator">*</span> <span class="number">100</span></span><span class="text">
</span><span class="text">
</span>        <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                <span class="name">path</span> <span class="operator">=</span> <span class="name">matchPath</span><span class="operator">(</span><span class="name">quiz</span><span class="operator">,</span> <span class="name">percentage</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">except</span> <span class="name">NoMatchingPath</span><span class="operator">:</span><span class="text">
</span>                <span class="name">path</span> <span class="operator">=</span> <span class="name">False</span><span class="text">
</span>                        <span class="text">
</span>        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/quiz/submitQuiz.html'</span><span class="operator">,</span> \
                        <span class="operator">{</span><span class="string">'course'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> <span class="string">'course_slug'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> \
                         <span class="string">'page_slug'</span><span class="operator">:</span><span class="name">page_slug</span><span class="operator">,</span> <span class="string">'pid'</span><span class="operator">:</span><span class="name">page_slug</span><span class="operator">,</span> <span class="string">'score'</span><span class="operator">:</span><span class="name">score</span><span class="operator">,</span> <span class="string">'maxScore'</span><span class="operator">:</span><span class="name">maxScore</span><span class="operator">,</span> <span class="string">'percentage'</span><span class="operator">:</span><span class="name">percentage</span><span class="operator">,</span> <span class="string">'path'</span><span class="operator">:</span><span class="name">path</span><span class="operator">}</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span><span class="keyword">def</span> <span class="name">edit_quiz</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>        <span class="string">''' edit_quiz View
                This view allows an instructor or other priviledged user to edit a quiz. The instructor can add, modify,
                or remove questions and other quiz attributes. The modified quiz is then submitted to the database.

                Note 1) Pressing "New Multiple Choice Question" will discard any changes made to the quiz, returning it 
                                to its previous state but with a new multiple choice question appended at the end
        '''</span><span class="text">
</span><span class="notcovered">        <span class="name">page_slug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">page_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="comment"># Make sure the course actually exists in the database
</span>        <span class="keyword">try</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="name">course</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">course_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">except</span> <span class="name">Course</span><span class="operator">.</span><span class="name">DoesNotExist</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">raise</span> <span class="name">Http404</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="comment"># Make sure the quiz actually exists in the database
</span>        <span class="keyword">try</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="name">quiz</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="operator">(</span><span class="name">page_slug</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="name">workingCopy</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="operator">(</span><span class="name">page_slug</span> <span class="operator">+</span> <span class="string">"_workingCopy"</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">except</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">DoesNotExist</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">raise</span> <span class="name">Http404</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="name">allPages</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">course_slug</span><span class="operator">)</span><span class="operator">.</span><span class="name">pages</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">questions</span> <span class="operator">=</span> <span class="name">workingCopy</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="operator">.</span><span class="name">order_by</span><span class="operator">(</span><span class="string">"order"</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">prerequisites</span> <span class="operator">=</span> <span class="name">workingCopy</span><span class="operator">.</span><span class="name">prerequisites</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">paths</span> <span class="operator">=</span> <span class="name">workingCopy</span><span class="operator">.</span><span class="name">paths</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="operator">.</span><span class="name">order_by</span><span class="operator">(</span><span class="string">"lowscore"</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">prereqs</span> <span class="operator">=</span> <span class="operator">[</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">        <span class="name">errors</span> <span class="operator">=</span> <span class="operator">[</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">        <span class="name">pages</span> <span class="operator">=</span> <span class="operator">[</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">allPages</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">if</span> <span class="operator">(</span><span class="name">p</span><span class="operator">.</span><span class="name">slug</span> <span class="operator">==</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">p</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">pages</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="name">p</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">prerequisites</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="name">prereqs</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="name">p</span><span class="operator">.</span><span class="name">requiredQuiz</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="keyword">if</span> <span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">method</span> <span class="operator">==</span> <span class="string">"POST"</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">if</span> <span class="string">"Save"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">r</span> <span class="operator">=</span> <span class="name">saveQuiz</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">page_slug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">r</span><span class="operator">[</span><span class="string">"quiz_slug"</span><span class="operator">]</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">errors</span> <span class="operator">=</span> <span class="name">r</span><span class="operator">[</span><span class="string">"errors"</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">errors</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">reverse</span><span class="operator">(</span><span class="string">'pages.views.show_page'</span><span class="operator">,</span> <span class="name">args</span><span class="operator">=</span><span class="operator">[</span><span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">]</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="string">"Cancel"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">reverse</span><span class="operator">(</span><span class="string">'pages.views.show_page'</span><span class="operator">,</span> <span class="name">args</span><span class="operator">=</span><span class="operator">[</span><span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">]</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="string">"Delete"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">delete_quiz</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="string">"ConfirmDelete"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">removeQuiz</span><span class="operator">(</span><span class="name">quiz</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">reverse</span><span class="operator">(</span><span class="string">'courses.views.show_course'</span><span class="operator">,</span> <span class="name">args</span><span class="operator">=</span><span class="operator">[</span><span class="name">course_slug</span><span class="operator">]</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="string">"Move"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">reverse</span><span class="operator">(</span><span class="string">'pages.views.move_page'</span><span class="operator">,</span> <span class="name">args</span><span class="operator">=</span><span class="operator">[</span><span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">]</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="string">"NewMultQuestion"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">addMultipleChoiceQuestion</span><span class="operator">(</span><span class="name">workingCopy</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">path</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="string">"NewCodeQuestion"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">addCodeQuestion</span><span class="operator">(</span><span class="name">workingCopy</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">path</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="string">"Publish"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">r</span> <span class="operator">=</span> <span class="name">saveQuiz</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">page_slug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">r</span><span class="operator">[</span><span class="string">"quiz_slug"</span><span class="operator">]</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">errors</span> <span class="operator">=</span> <span class="name">r</span><span class="operator">[</span><span class="string">"errors"</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">errors</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">workingCopy</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="operator">(</span><span class="name">page_slug</span> <span class="operator">+</span> <span class="string">"_workingCopy"</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">publishQuiz</span><span class="operator">(</span><span class="name">workingCopy</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">reverse</span><span class="operator">(</span><span class="string">'pages.views.show_page'</span><span class="operator">,</span> <span class="name">args</span><span class="operator">=</span><span class="operator">[</span><span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">]</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="string">"Revert"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">revertQuiz</span><span class="operator">(</span><span class="name">workingCopy</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">reverse</span><span class="operator">(</span><span class="string">'pages.views.show_page'</span><span class="operator">,</span> <span class="name">args</span><span class="operator">=</span><span class="operator">[</span><span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">]</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="string">"AddPath"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">add_path</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">,</span> <span class="name">errors</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="string">"SubmitAddPath"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">errors</span> <span class="operator">=</span> <span class="name">addPath</span><span class="operator">(</span><span class="name">workingCopy</span><span class="operator">,</span> <span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">errors</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">path</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">else</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">return</span> <span class="name">add_path</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">,</span> <span class="name">errors</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="string">"EditPath"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="string">"path"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">return</span> <span class="name">edit_path</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">,</span> <span class="name">errors</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">else</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"You must select a path to edit"</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="string">"SubmitEditPath"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">errors</span> <span class="operator">=</span> <span class="name">editPath</span><span class="operator">(</span><span class="name">workingCopy</span><span class="operator">,</span> <span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">errors</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">path</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">else</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">return</span> <span class="name">edit_path</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">,</span> <span class="name">errors</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="string">"RemovePath"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="string">"path"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">errors</span> <span class="operator">=</span> <span class="name">removePath</span><span class="operator">(</span><span class="name">workingCopy</span><span class="operator">,</span> <span class="name">request</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">errors</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                        <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">path</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">else</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"You must select a path to remove"</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                <span class="keyword">for</span> <span class="name">q</span> <span class="keyword">in</span> <span class="name">questions</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="string">"removeQuestion%s"</span> <span class="operator">%</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">)</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">return</span> <span class="name">remove_question</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">page_slug</span><span class="operator">,</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="string">"confirmRemoveQuestion%s"</span> <span class="operator">%</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">)</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">removeQuestion</span><span class="operator">(</span><span class="name">q</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">reorderQuestions</span><span class="operator">(</span><span class="name">workingCopy</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">path</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">isMultipleChoiceQuestion</span><span class="operator">(</span><span class="name">q</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">q</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">multiplechoicequestion</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">if</span> <span class="operator">(</span><span class="string">"addAnswer%s"</span> <span class="operator">%</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">)</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                        <span class="name">addAnswer</span><span class="operator">(</span><span class="name">q</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                        <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">path</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">for</span> <span class="name">a</span> <span class="keyword">in</span> <span class="name">q</span><span class="operator">.</span><span class="name">answers</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                        <span class="keyword">if</span> <span class="operator">(</span><span class="string">"removeAnswerQ%sA%s"</span> <span class="operator">%</span> <span class="operator">(</span><span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">,</span> <span class="name">a</span><span class="operator">.</span><span class="name">order</span><span class="operator">)</span><span class="operator">)</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                                <span class="name">removeAnswer</span><span class="operator">(</span><span class="name">q</span><span class="operator">,</span> <span class="name">a</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                                <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">path</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'page/quiz/edit_quiz.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'course_slug'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">,</span> <span class="string">'page_slug'</span><span class="operator">:</span><span class="name">page_slug</span><span class="operator">,</span> <span class="string">'pages'</span><span class="operator">:</span><span class="name">pages</span><span class="operator">,</span> <span class="string">'quiz'</span><span class="operator">:</span><span class="name">workingCopy</span><span class="operator">,</span> <span class="string">'questions'</span><span class="operator">:</span><span class="name">questions</span><span class="operator">,</span> <span class="string">'prereqs'</span><span class="operator">:</span><span class="name">prereqs</span><span class="operator">,</span> <span class="string">'errors'</span><span class="operator">:</span><span class="name">errors</span><span class="operator">,</span> <span class="string">'paths'</span><span class="operator">:</span><span class="name">paths</span><span class="operator">}</span><span class="operator">)</span><span class="text"></span></span>
</pre></body>
</html>
